{% extends "admin/admin_base.html" %}
{% block admin_content %}
<div class="admin-page-header">
  <h2><i class="bi bi-clock-history"></i>Historia treningów</h2>
</div>

<div class="admin-card">
  <div class="table-scroll">
    <table class="admin-table">
      <thead>
        <tr>
          <th>Data</th>
          <th>Miejsce</th>
          <th>Trener</th>
          <th>Wolontariusze</th>
          <th>Status</th>
          <th class="text-end">Akcje</th>
        </tr>
      </thead>
      <tbody>
        {% for t in trainings %}
        <tr>
          <td><strong>{{ t.date.strftime('%d.%m.%Y') }}</strong><br><small>{{ t.date.strftime('%H:%M') }}</small></td>
          <td>{{ t.location.name }}</td>
          <td>
            {{ t.coach.first_name }} {{ t.coach.last_name }}
            <br><small><a href="tel:{{ t.coach.phone_number }}">{{ t.coach.phone_number|format_phone }}</a></small>
          </td>
          <td>
            {% for b in t.bookings %}
              <div class="vol-slot mb-1">
                <span class="vol-name">{{ b.volunteer.first_name }} {{ b.volunteer.last_name }}</span>
                <span class="vol-contact">({{ b.volunteer.email }})</span>
              </div>
            {% else %}
              <span class="vol-slot-empty">— brak —</span>
            {% endfor %}
          </td>
          <td>
            {% if t.is_deleted %}
              <span class="badge bg-secondary"><i class="bi bi-trash me-1"></i>Usunięty</span>
            {% elif t.is_canceled %}
              <span class="badge-canceled"><i class="bi bi-x-circle me-1"></i>Odwołany</span>
            {% else %}
              <span class="badge-confirmed"><i class="bi bi-check-circle me-1"></i>Odbył się</span>
            {% endif %}
          </td>
          <td class="text-end">
            <form method="post" action="{{ url_for('admin.remove_training', training_id=t.id) }}" class="d-inline">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-icon btn-outline-secondary" title="Usuń trwale">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if pagination.pages > 1 %}
<nav aria-label="Paginacja" class="mt-3">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin.history', page=pagination.prev_num) }}">&laquo;</a>
    </li>
    {% for p in range(1, pagination.pages + 1) %}
    <li class="page-item {% if p == pagination.page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('admin.history', page=p) }}">{{ p }}</a>
    </li>
    {% endfor %}
    <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin.history', page=pagination.next_num) }}">&raquo;</a>
    </li>
  </ul>
</nav>
{% endif %}
{% endblock %}
